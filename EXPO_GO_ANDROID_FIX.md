# ‚úÖ EXPO GO ANDROID FIX ‚Äî –ó–ê–í–ï–†–®–ï–ù–û

## üìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ PART 1 ‚Äî FIX expo-notifications / Expo Go (Android)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã `expo-notifications` –≤—ã–∑—ã–≤–∞–ª–∏ –∫—Ä–∞—Å–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ Expo Go –Ω–∞ Android.

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `lib/notifications/request-notifications-safe.ts` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
2. ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã `expo-notifications` –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –æ–±—ë—Ä—Ç–∫—É —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `lib/notifications/request-notifications-safe.ts` ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏
- `services/pushNotifications.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `setupNotificationHandlerSafe()`
- `lib/permissions/request-permissions.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞
- `utils/testNotification.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë–´–õ–û (–≤—ã–∑—ã–≤–∞–ª–æ –∫—Ä–∞—à):
import * as Notifications from 'expo-notifications';

// –°–¢–ê–õ–û (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
const Notifications = await import('expo-notifications');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úî Android Expo Go –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–π —ç–∫—Ä–∞–Ω
- ‚úî Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ Expo Go
- ‚úî –í dev/prod –±–∏–ª–¥–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ

---

### ‚úÖ PART 2 ‚Äî FIX Property 'router' doesn't exist

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `app/_layout.tsx` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `router.replace()` –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è `router`.

**–†–µ—à–µ–Ω–∏–µ:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `useRouter()` –≤ –∏–º–ø–æ—Ä—Ç—ã
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ `const router = useRouter();` –≤ –Ω–∞—á–∞–ª–µ `AppContent()`
3. ‚úÖ –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `rootNavState.router` (–µ—ë –Ω–µ –±—ã–ª–æ, –Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `app/_layout.tsx` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `useRouter()` –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ `router`

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë–´–õ–û:
function AppContent() {
  const rootNavState = useRootNavigationState();
  const segments = useSegments();
  // ... router.replace() –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

// –°–¢–ê–õ–û:
function AppContent() {
  const router = useRouter(); // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  const rootNavState = useRootNavigationState();
  const segments = useSegments();
  // ... router.replace() —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úî –ù–µ—Ç –æ—à–∏–±–∫–∏ "Property 'router' doesn't exist"
- ‚úî –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úî Auth redirects —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìù –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç expo-notifications

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç:

```typescript
// lib/notifications/request-notifications-safe.ts
export async function requestNotificationsPermissionsSafe() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ Expo Go
  if (Platform.OS === 'android' && isExpoGo) {
    return { granted: false, reason: 'expo-go-android-not-supported' };
  }

  // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç - –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—à
  const Notifications = await import('expo-notifications');
  // ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Notifications
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ handler

–°–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ notification handler:

```typescript
export async function setupNotificationHandlerSafe(): Promise<void> {
  if (isExpoGo) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤ Expo Go
  
  const Notifications = await import('expo-notifications');
  Notifications.setNotificationHandler({ ... });
}
```

### Router –≤ _layout.tsx

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ API:

```typescript
function AppContent() {
  const router = useRouter(); // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
  const segments = useSegments();
  
  useEffect(() => {
    if (!isAuthenticated && !inAuthGroup) {
      router.replace('/(auth)/phone'); // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
    } else if (isAuthenticated && inAuthGroup) {
      router.replace('/(tabs)'); // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
    }
  }, [isAuthenticated, authLoading, isReady, segments, router]);
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ expo-notifications

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Expo Go –Ω–∞ Android
2. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã)
4. ‚úÖ –í dev/prod –±–∏–ª–¥–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ router

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–∫–∏ "Property 'router' doesn't exist"
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å auth flow:
   - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/(auth)/phone`
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/(tabs)`
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
   - –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ ‚Üí –∑–∞–ø—Ä–æ—Å –∫–æ–¥–∞
   - –í–≤–æ–¥ –∫–æ–¥–∞ ‚Üí —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω

---

## üìä –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `lib/notifications/request-notifications-safe.ts` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∏–º–ø–æ—Ä—Ç–æ–º
2. `services/pushNotifications.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç
3. `lib/permissions/request-permissions.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç
4. `utils/testNotification.ts` ‚Äî —É–¥–∞–ª—ë–Ω –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç
5. `app/_layout.tsx` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `useRouter()`

### Legacy —Ñ–∞–π–ª—ã (–Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å):
- `legacy/360auto-marketplace/mobile/pushNotifications.ts` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `legacy/360auto-marketplace/mobile/permissions/request-permissions.ts` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### expo-notifications
- ‚úî –ù–µ—Ç –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–æ–¥–µ
- ‚úî –í—Å–µ –≤—ã–∑–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –æ–±—ë—Ä—Ç–∫—É
- ‚úî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—à –≤ Expo Go
- ‚úî –í dev/prod –±–∏–ª–¥–∞—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ

### Router
- ‚úî `router` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω —á–µ—Ä–µ–∑ `useRouter()`
- ‚úî –ù–µ—Ç –æ—à–∏–±–∫–∏ "Property 'router' doesn't exist"
- ‚úî –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úî Auth redirects —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úî –ù–µ —Å–ª–æ–º–∞–Ω–∞
- ‚úî –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úî –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:
```bash
grep -r "import.*from ['\"]expo-notifications['\"]" --exclude-dir=legacy --exclude-dir=node_modules
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ –≤ legacy –∏ docs).

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç** ‚Äî –∫–ª—é—á–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Expo Go —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
2. **useRouter()** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è router –≤ Expo Router
3. **Legacy —Ñ–∞–π–ª—ã** ‚Äî –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∫–æ–¥–µ
4. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å dev/prod –±–∏–ª–¥–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´

**–î–∞—Ç–∞:** 2025-01-29

