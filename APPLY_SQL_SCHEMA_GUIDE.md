# üóÑÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é SQL —Å—Ö–µ–º—ã –≤ Supabase

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª `supabase-complete-schema-apivideo.sql` –≤ –≤–∞—à–µ–π Supabase –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

---

## üåê –°–ü–û–°–û–ë 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard

### –®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **360Auto** (–∏–ª–∏ –∫–∞–∫ –≤—ã –µ–≥–æ –Ω–∞–∑–≤–∞–ª–∏)

### –®–∞–≥ 3: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor

–í –ª–µ–≤–æ–º –º–µ–Ω—é:
1. –ö–ª–∏–∫–Ω–∏—Ç–µ **"SQL Editor"** 
2. –ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ **"Database"** ‚Üí **"SQL Editor"**

### –®–∞–≥ 4: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

1. –ù–∞–∂–º–∏—Ç–µ **"+ New query"**
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **"New query"** –≤–≤–µ—Ä—Ö—É

### –®–∞–≥ 5: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase-complete-schema-apivideo.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–°–Å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (Cmd+A, Cmd+C)

### –®–∞–≥ 6: –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor

1. –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL (Cmd+V)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω

### –®–∞–≥ 7: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å

1. –ù–∞–∂–º–∏—Ç–µ **"Run"** –∏–ª–∏ **Ctrl+Enter**
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥)

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ SQL —Å—Ö–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!
total_cars: [—á–∏—Å–ª–æ –≤–∞—à–∏—Ö –∞–≤—Ç–æ]
```

---

## üíª –°–ü–û–°–û–ë 2: –ß–µ—Ä–µ–∑ psql (–¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- PostgreSQL client —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ï—Å—Ç—å connection string –æ—Ç Supabase

### –ü–æ–ª—É—á–∏—Ç–µ Connection String:

1. Supabase Dashboard ‚Üí **Settings** ‚Üí **Database**
2. –ù–∞–π–¥–∏—Ç–µ **"Connection string"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"URI"**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫: `postgresql://postgres:[PASSWORD]@...`)

### –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ [PASSWORD] –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
psql "postgresql://postgres:[PASSWORD]@db.xxx.supabase.co:5432/postgres" \
  -f /Users/ulanbekgaiypov/360AutoMVP/supabase-complete-schema-apivideo.sql
```

---

## üîß –°–ü–û–°–û–ë 3: –ß–µ—Ä–µ–∑ Supabase CLI

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI:

```bash
npm install -g supabase
```

### –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å:

```bash
supabase login
```

### –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
cd /Users/ulanbekgaiypov/360AutoMVP
supabase db push --db-url "postgresql://postgres:[PASSWORD]@db.xxx.supabase.co:5432/postgres"
```

---

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç SQL —Å–∫—Ä–∏–ø—Ç:

### 1. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É `cars`:
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `video_id` (–¥–ª—è api.video)
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `thumbnail_url`
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `views_before_boost`

### 2. –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã:
- ‚úÖ `idx_cars_video_id` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ video_id
- ‚úÖ `idx_cars_views` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
- ‚úÖ `idx_cars_likes` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–∞–π–∫–∞–º
- ‚úÖ `idx_cars_trending` - –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –∞–≤—Ç–æ

### 3. –°–æ–∑–¥–∞–µ—Ç SQL —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ `increment_views(uuid)` - +1 –ø—Ä–æ—Å–º–æ—Ç—Ä
- ‚úÖ `increment_likes(uuid)` - +1 –ª–∞–π–∫
- ‚úÖ `decrement_likes(uuid)` - -1 –ª–∞–π–∫
- ‚úÖ `get_trending_cars(interval, limit)` - —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ –∞–≤—Ç–æ
- ‚úÖ `get_high_engagement_cars(limit)` - —Ç–æ–ø –ø–æ engagement
- ‚úÖ `get_video_stats(uuid)` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–¥–µ–æ

### 4. –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã:
- ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/–ª–∞–π–∫–æ–≤

### 5. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏:
- ‚úÖ –í—Å–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL —Å—Ö–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ SQL Editor:

#### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É:
```sql
SELECT 
  column_name, 
  data_type 
FROM information_schema.columns 
WHERE table_name = 'cars' 
  AND column_name IN ('video_id', 'thumbnail_url', 'views_before_boost');
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 3 —Å—Ç—Ä–æ–∫–∏ ‚úÖ

#### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:
```sql
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_name LIKE '%car%' OR routine_name LIKE '%view%' OR routine_name LIKE '%like%';
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π ‚úÖ

#### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã:
```sql
SELECT indexname 
FROM pg_indexes 
WHERE tablename = 'cars' AND indexname LIKE 'idx_cars_%';
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ ‚úÖ

#### 4. –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:
```sql
-- –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ –∞–≤—Ç–æ –∑–∞ –Ω–µ–¥–µ–ª—é
SELECT * FROM get_trending_cars('7 days'::interval, 10);
```

#### 5. –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ engagement:
```sql
-- –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø –ø–æ engagement
SELECT * FROM get_high_engagement_cars(10);
```

---

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:

### –û—à–∏–±–∫–∞: "relation cars does not exist"

**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `cars`:

```sql
CREATE TABLE cars (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  video_id TEXT,
  video_url TEXT NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  brand TEXT NOT NULL,
  model TEXT NOT NULL,
  year INTEGER NOT NULL,
  mileage INTEGER,
  color TEXT,
  transmission TEXT,
  fuel_type TEXT,
  city TEXT,
  seller_id UUID REFERENCES users(id),
  likes INTEGER DEFAULT 0,
  views INTEGER DEFAULT 0,
  saves INTEGER DEFAULT 0,
  shares INTEGER DEFAULT 0,
  messages_count INTEGER DEFAULT 0,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### –û—à–∏–±–∫–∞: "column already exists"

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### –û—à–∏–±–∫–∞: "permission denied"

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **postgres** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ **service_role** –∫–ª—é—á.

---

## üìä –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

### –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–º–æ–∂–µ—Ç:

1. ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ –Ω–∞ api.video
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å `video_id` –≤ Supabase
3. ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∏ –ª–∞–π–∫–∏
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ –∞–≤—Ç–æ
5. ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å engagement rate
6. ‚úÖ TikTok-style –ª–µ–Ω—Ç–∞ —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º scroll

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL —Å—Ö–µ–º—É (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ expo-image-picker: `npx expo install expo-image-picker@~17.0.8`
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ Expo: `npx expo start`
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –≤–∏–¥–µ–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

---

## üìû –ü–æ–º–æ—â—å:

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ SQL Editor
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `cars` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `users` —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞)
4. –ß–∏—Ç–∞–π—Ç–µ `APIVIDEO_INTEGRATION_GUIDE.md`

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL —Å—Ö–µ–º—ã –≤—Å—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! üöÄ

