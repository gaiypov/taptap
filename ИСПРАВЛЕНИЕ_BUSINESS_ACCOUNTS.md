# ๐ง ะะกะะะะะะะะะ: Business Accounts RLS

## ๐ ะัะพะฑะปะตะผะฐ:

```
Error loading business accounts:
{"code":"42501","message":"permission denied for table business_accounts"}
```

### ะัะธัะธะฝะฐ:
RLS ะฟะพะปะธัะธะบะฐ ัะฐะทัะตัะฐะปะฐ ะฒะธะดะตัั ัะพะปัะบะพ ะกะะะ ะฑะธะทะฝะตั-ะฐะบะบะฐัะฝั:
```sql
CREATE POLICY "Users can view their own business account"
  ON business_accounts FOR SELECT
  USING (auth.uid() = user_id);  โ
```

ะะพ ะฟัะธะปะพะถะตะฝะธั ะฝัะถะฝะพ ะฒะธะดะตัั ะฑะธะทะฝะตั-ะฐะบะบะฐัะฝัั ะะะฃะะะฅ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะดะปั:
- ะะพะบะฐะทะฐ ะฟัะธะพัะธัะตัะฝัั ะพะฑััะฒะปะตะฝะธะน (priority-boost)
- ะัะพะฑัะฐะถะตะฝะธั ะฑะตะนะดะถะตะน "ะะธะทะฝะตั" ะฝะฐ ะบะฐััะพัะบะฐั
- ะกะพััะธัะพะฒะบะธ ะพะฑััะฒะปะตะฝะธะน

---

## โ ะะตัะตะฝะธะต:

### 1. ะัะธะผะตะฝะธัั SQL ะธัะฟัะฐะฒะปะตะฝะธะต ะฒ Supabase:

ะัะบัะพะนัะต Supabase Dashboard โ SQL Editor ะธ ะฒัะฟะพะปะฝะธัะต ัะฐะนะป:
```
FIX_BUSINESS_ACCOUNTS_RLS.sql
```

ะะปะธ ัะบะพะฟะธััะนัะต ะบะพะผะฐะฝะดั:

```sql
-- ะฃะดะฐะปะธัั ััะฐััั ะฟะพะปะธัะธะบั
DROP POLICY IF EXISTS "Users can view their own business account" ON business_accounts;

-- ะกะพะทะดะฐัั ะฟัะฑะปะธัะฝัั ะฟะพะปะธัะธะบั (ะฒัะต ะผะพะณัั ะฒะธะดะตัั)
CREATE POLICY "Anyone can view business accounts"
  ON business_accounts FOR SELECT
  USING (true);
```

### 2. ะะตัะตะทะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต:
```bash
npm start
```

---

## ๐ ะงัะพ ะธะทะผะตะฝะธะปะพัั:

| ะะพ | ะะพัะปะต |
|----|-------|
| โ ะขะพะปัะบะพ ะฒะปะฐะดะตะปะตั ะฒะธะดะธั ัะฒะพะน ะฐะบะบะฐัะฝั | โ ะัะต ะฒะธะดัั ะฒัะต ะฑะธะทะฝะตั-ะฐะบะบะฐัะฝัั |
| โ ะะตะปัะทั ะฟะพะบะฐะทะฐัั ะฟัะธะพัะธัะตัะฝัะต ะพะฑััะฒะปะตะฝะธั | โ ะัะธะพัะธัะตัะฝัะต ะพะฑััะฒะปะตะฝะธั ัะฐะฑะพัะฐัั |
| โ ะะตั ะฑะตะนะดะถะตะน ะฝะฐ ะบะฐััะพัะบะฐั | โ ะะตะนะดะถะธ "ะะธะทะฝะตั" ะฒะธะดะฝั |

### ะะตะทะพะฟะฐัะฝะพััั:
- โ **ะงัะตะฝะธะต:** ะัะฑะปะธัะฝะพะต (ะฒัะต ะฒะธะดัั ะฑะธะทะฝะตั-ะฐะบะบะฐัะฝัั)
- โ **ะกะพะทะดะฐะฝะธะต:** ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั
- โ **ะะฑะฝะพะฒะปะตะฝะธะต:** ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั
- โ **ะฃะดะฐะปะตะฝะธะต:** ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต:

### 1. ะัะพะฒะตัะธัั ััะพ ะฟะพะปะธัะธะบะธ ะฟัะธะผะตะฝะตะฝั:
```sql
SELECT policyname, cmd 
FROM pg_policies 
WHERE tablename = 'business_accounts';
```

ะะพะปะถะฝะพ ะฟะพะบะฐะทะฐัั:
```
"Anyone can view business accounts" | SELECT
"Users can insert their own business account" | INSERT
"Users can update their own business account" | UPDATE
```

### 2. ะ ะฟัะธะปะพะถะตะฝะธะธ:
1. ะัะบัะพะนัะต ะณะปะฐะฒะฝัะน ัะบัะฐะฝ (ะปะตะฝัะฐ)
2. ะะธััะฐะนัะต ะพะฑััะฒะปะตะฝะธั
3. ะัะธะฑะบะฐ "permission denied" ะดะพะปะถะฝะฐ ะธััะตะทะฝััั โ

---

## ๐ฏ ะะปััะตัะฝะฐัะธะฒะฝะพะต ัะตัะตะฝะธะต (ะตัะปะธ ะฝัะถะฝะฐ ะฑะพะปััะฐั ะฟัะธะฒะฐัะฝะพััั):

ะัะปะธ ัะพัะธัะต ัะบัััั ะฝะตะบะพัะพััะต ะดะฐะฝะฝัะต ะฑะธะทะฝะตั-ะฐะบะบะฐัะฝัะฐ:

```sql
-- ะัะฑะปะธัะฝะฐั ะฟะพะปะธัะธะบะฐ ั ะพะณัะฐะฝะธัะตะฝะธัะผะธ
CREATE POLICY "Public can view limited business info"
  ON business_accounts FOR SELECT
  USING (
    -- ะะพะบะฐะทัะฒะฐะตะผ ัะพะปัะบะพ ะฐะบัะธะฒะฝัะต ะฐะบะบะฐัะฝัั
    subscription_end_date > NOW() AND
    -- ะกะบััะฒะฐะตะผ ะทะฐะฑะปะพะบะธัะพะฒะฐะฝะฝัะต
    NOT is_blocked
  );
```

---

## ๐ ะกัััะบัััะฐ ะฟัะฐะฒ:

```
business_accounts (ัะฐะฑะปะธัะฐ)
โโโ SELECT (ััะตะฝะธะต) 
โ   โโโ โ ะัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ (ะฟัะฑะปะธัะฝะพ)
โโโ INSERT (ัะพะทะดะฐะฝะธะต)
โ   โโโ โ ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั
โโโ UPDATE (ะพะฑะฝะพะฒะปะตะฝะธะต)
โ   โโโ โ ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั
โโโ DELETE (ัะดะฐะปะตะฝะธะต)
    โโโ โ ะขะพะปัะบะพ ัะฒะพะน ะฐะบะบะฐัะฝั
```

---

## โ ะะพัะพะฒะพ!

ะะพัะปะต ะฟัะธะผะตะฝะตะฝะธั SQL:
1. โ ะัะธะฑะบะฐ "permission denied" ะธััะตะทะฝะตั
2. โ ะัะธะพัะธัะตัะฝัะต ะพะฑััะฒะปะตะฝะธั ะทะฐัะฐะฑะพัะฐัั
3. โ ะะตะนะดะถะธ "ะะธะทะฝะตั" ะฑัะดัั ะฒะธะดะฝั
4. โ ะกะพััะธัะพะฒะบะฐ ะฟะพ ะฟัะธะพัะธัะตัั ะทะฐัะฐะฑะพัะฐะตั

---

**ะะฐัะฐ:** 19 ะพะบััะฑัั 2025  
**ะคะฐะนะป SQL:** `FIX_BUSINESS_ACCOUNTS_RLS.sql`

