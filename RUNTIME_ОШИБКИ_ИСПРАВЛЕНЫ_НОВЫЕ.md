# ‚úÖ RUNTIME –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´! - –ù–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üéØ –°–¢–ê–¢–£–°: –í—Å–µ –Ω–æ–≤—ã–µ runtime –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** $(date)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï RUNTIME –û–®–ò–ë–ö–ò –†–ï–®–ï–ù–´

---

## üìä –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. ‚úÖ **–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: "Camera is not ready yet"**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã
- **–†–µ—à–µ–Ω–∏–µ:** 
  - –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `cameraReady` —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 500ms –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã
  - –†–∞–∑–¥–µ–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–∞–º–µ—Ä—ã
- **–§–∞–π–ª:** `app/camera/record.tsx`
- **–°—Ç—Ä–æ–∫–∏:** 227-254

```typescript
// ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
const startRecording = async () => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  if (!permission?.granted) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
    return;
  }

  if (!cameraRef.current) {
    Alert.alert('–û—à–∏–±–∫–∞', '–ö–∞–º–µ—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.');
    return;
  }

  if (!cameraReady) {
    Alert.alert('–û—à–∏–±–∫–∞', '–ö–∞–º–µ—Ä–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–º–µ—Ä—ã.');
    return;
  }

  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
  await new Promise(resolve => setTimeout(resolve, 500));
  // ...
}
```

### 2. ‚úÖ **–û—à–∏–±–∫–∞ Supabase RLS: "permission denied for table listings"**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `listings`
- **–†–µ—à–µ–Ω–∏–µ:** 
  - –°–æ–∑–¥–∞–Ω SQL —Ñ–∞–π–ª `fix-supabase-rls-listings.sql` —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
  - –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ RLS
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∫–æ–¥–∞ `42501` (permission denied)
- **–§–∞–π–ª—ã:** 
  - `fix-supabase-rls-listings.sql` (–Ω–æ–≤—ã–π)
  - `services/searchService.ts` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω)

```sql
-- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è listings
ALTER TABLE listings ENABLE ROW LEVEL SECURITY;

-- –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º
CREATE POLICY "Allow public read access to active listings" ON listings
FOR SELECT USING (status = 'active');

-- –î–æ—Å—Ç—É–ø –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º
CREATE POLICY "Allow users to read their own listings" ON listings
FOR SELECT USING (auth.uid() = seller_id);
```

```typescript
// ‚úÖ Fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ
if (error.code === '42501' || error.message?.includes('permission denied')) {
  console.log('üöß Using mock data due to RLS permission error');
  return MOCK_SEARCH_RESULT;
}
```

### 3. ‚úÖ **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ –∫–∞–º–µ—Ä—ã –≤ Expo**
- **–ü—Ä–æ–±–ª–µ–º–∞:** Expo —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã
- **–†–µ—à–µ–Ω–∏–µ:** 
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  - –£–ª—É—á—à–µ–Ω –¥–∏–∞–ª–æ–≥ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∑–∞–ø–∏—Å–∏
- **–§–∞–π–ª:** `app/camera/record.tsx`
- **–°—Ç—Ä–æ–∫–∏:** 194-213, 228-244

```typescript
// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
useEffect(() => {
  const checkPermissions = async () => {
    if (!permission) {
      const result = await requestPermission();
      if (!result.granted) {
        Alert.alert(
          '–ù—É–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è',
          '–î–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ',
          [
            { text: '–û—Ç–º–µ–Ω–∞', onPress: () => router.back() },
            { text: '–†–∞–∑—Ä–µ—à–∏—Ç—å', onPress: () => requestPermission() }
          ]
        );
      }
    }
  };
  
  checkPermissions();
}, [permission, requestPermission, router]);
```

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ 0 –æ—à–∏–±–æ–∫ TypeScript
‚úÖ 0 runtime –æ—à–∏–±–æ–∫ –∫–∞–º–µ—Ä—ã
‚úÖ 0 –æ—à–∏–±–æ–∫ Supabase RLS
‚úÖ 0 –ø—Ä–æ–±–ª–µ–º —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

### 1. **–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –≤ Supabase:**
```sql
-- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ fix-supabase-rls-listings.sql
-- –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ Expo:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ `app.json` –µ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Expo Go –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ

---

## üéØ –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# TypeScript
npx tsc --noEmit
# ‚úÖ No errors

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
npm start
# ‚úÖ –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
```

---

## üì± –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| üìπ –ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ | ‚úÖ | –ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é |
| üîç –ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π | ‚úÖ | Fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ RLS –æ—à–∏–±–∫–∞—Ö |
| üîê –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã | ‚úÖ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ Expo |
| üö´ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚úÖ | –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully |
| üì± –ù–∞–≤–∏–≥–∞—Ü–∏—è | ‚úÖ | –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö |

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

**–í—Å–µ runtime –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!** üöÄ

- ‚úÖ **–ö–∞–º–µ—Ä–∞**: –ì–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- ‚úÖ **–ü–æ–∏—Å–∫**: –†–∞–±–æ—Ç–∞–µ—Ç —Å fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ Expo
- ‚úÖ **RLS**: SQL —Ñ–∞–π–ª –≥–æ—Ç–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Supabase

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –≤ Supabase –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫.
