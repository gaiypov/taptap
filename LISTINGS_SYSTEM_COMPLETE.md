# ‚úÖ LISTINGS SYSTEM - –ü–û–õ–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

## üéâ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ –ª–æ—à–∞–¥–∏), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º, AI –∞–Ω–∞–ª–∏–∑–æ–º –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å api.video.

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. SQL –°—Ö–µ–º—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

#### `supabase-listings-schema.sql`
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `listings` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –¥–ª—è –∞–≤—Ç–æ + –ª–æ—à–∞–¥–µ–π)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ `expires_at` (90 –¥–Ω–µ–π)
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ `delete_at` (14 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏)
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏: `increment_listing_views`, `increment_listing_likes`, `get_trending_listings`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `cars` –≤ `listings`

#### `supabase-cron-schedule.sql`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pg_cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ cleanup
- ‚úÖ –ï–∂–µ—á–∞—Å–Ω—ã–π cron job
- ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### 2. Backend API

#### `backend/api/listings.ts`
–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä API endpoints:
- `POST /api/listings/:id/mark-sold` - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–¥–∞–Ω–Ω–æ–µ
- `POST /api/listings/:id/reactivate` - –≤–µ—Ä–Ω—É—Ç—å –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ
- `POST /api/listings/:id/archive` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
- `GET /api/listings/:id` - –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
- `GET /api/listings` - —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

#### `backend/server.ts`
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –Ω–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã `/api/listings`

### 3. Supabase Edge Functions

#### `supabase/functions/cleanup-listings/index.ts`
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:
- ‚úÖ –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π (—á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π)
- ‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π (—á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ api.video –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 4. TypeScript —Ç–∏–ø—ã

#### `types/index.ts`
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∏–ø—ã:
- ‚úÖ `ListingStatus` - —Å—Ç–∞—Ç—É—Å—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚úÖ `ListingCategory` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (car, horse)
- ‚úÖ `HorseDetails` - –¥–µ—Ç–∞–ª–∏ –ª–æ—à–∞–¥–∏
- ‚úÖ `CarDetails` - –¥–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ `Listing` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ `HorseAIAnalysis` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç AI –∞–Ω–∞–ª–∏–∑–∞ –ª–æ—à–∞–¥–∏
- ‚úÖ Type guards: `isCarListing`, `isHorseListing`

### 5. React Native –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `components/Listing/SoldButton.tsx`
–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–Ω–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º:
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–¥–∞–Ω–Ω–æ–µ" –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å —Ç–∞–π–º–µ—Ä–æ–º –¥–ª—è –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í–µ—Ä–Ω—É—Ç—å –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ" (–≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–µ–π–¥–∂–∏ –¥–ª—è archived/expired
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π UI —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

#### `components/Feed/CategoryTabs.tsx`
–¢–∞–±—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
- ‚úÖ –¢–∞–±—ã "üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏" –∏ "üê¥ –õ–æ—à–∞–¥–∏"
- ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–± —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
- ‚úÖ –ö—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### `components/Feed/ListingVideoPlayer.tsx`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∏–¥–µ–æ –ø–ª–µ–µ—Ä –¥–ª—è listings:
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–µ–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (car/horse)
- ‚úÖ –†–∞–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ Overlay "–ü–†–û–î–ê–ù–û" –¥–ª—è –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥–∞–≤—Ü–µ —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ AI –æ—Ü–µ–Ω–∫–∞
- ‚úÖ –ë–æ–∫–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–ª–∞–π–∫, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –ø–æ–¥–µ–ª–∏—Ç—å—Å—è)
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

#### `app/index-with-categories.tsx`
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å —Ç–∞–±–∞–º–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ listings –≤–º–µ—Å—Ç–æ cars
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
- ‚úÖ –õ–∞–π–∫–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, —à–µ—Ä–∏–Ω–≥
- ‚úÖ Infinite scroll —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- ‚úÖ Pull-to-refresh
- ‚úÖ Empty states –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 6. AI —Å–µ—Ä–≤–∏—Å—ã

#### `services/aiHorse.ts`
–ü–æ–ª–Ω—ã–π AI –∞–Ω–∞–ª–∏–∑ –¥–ª—è –ª–æ—à–∞–¥–µ–π:
- ‚úÖ `analyzeHorseVideo()` - –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ
- ‚úÖ `quickIdentifyHorse()` - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ `validateHorseVideoQuality()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ `convertHorseAnalysisToDetails()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ HorseDetails
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Claude, OpenAI, Google Vision
- ‚úÖ Mock —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–æ—Ä–æ–¥
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Ç–∏ (—Ü–≤–µ—Ç–∞)
- ‚úÖ –û—Ü–µ–Ω–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ —Ä–æ—Å—Ç–∞
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤
- ‚úÖ Quality score

–ü—Ä–æ–º–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- 15+ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ—Ä–æ–¥ –ª–æ—à–∞–¥–µ–π
- 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–∞—Å—Ç–µ–π
- –û—Ü–µ–Ω–∫—É —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞
- Body Condition Score (BCS)
- –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### `LISTINGS_MIGRATION_GUIDE.md`
–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- ‚úÖ SQL —Å–∫—Ä–∏–ø—Ç—ã
- ‚úÖ API endpoints —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ—à–∞–¥–µ–π
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏
- ‚úÖ Troubleshooting
- ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 8. –°–∫—Ä–∏–ø—Ç—ã

#### `scripts/migrate-to-listings.ts`
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ cars –≤ listings
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚úÖ Dry-run —Ä–µ–∂–∏–º
- ‚úÖ Verbose —Ä–µ–∂–∏–º
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω
ts-node scripts/migrate-to-listings.ts --dry-run --verbose

# –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
ts-node scripts/migrate-to-listings.ts --verbose
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º

#### –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞:
```
–î–µ–Ω—å 0: –°–æ–∑–¥–∞–Ω–∏–µ
‚îî‚îÄ> status = 'active'
‚îî‚îÄ> expires_at = created_at + 90 –¥–Ω–µ–π

–î–µ–Ω—å X: –ü—Ä–æ–¥–∞–Ω–æ (–ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–¥–∞–≤—Ü–∞)
‚îî‚îÄ> status = 'sold'
‚îî‚îÄ> sold_at = NOW()
‚îî‚îÄ> delete_at = sold_at + 14 –¥–Ω–µ–π

–î–µ–Ω—å X + 14: –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
‚îî‚îÄ> status = 'archived'
‚îî‚îÄ> –í–∏–¥–µ–æ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ api.video

–î–µ–Ω—å 90 (–µ—Å–ª–∏ –Ω–µ –ø—Ä–æ–¥–∞–Ω–æ): –ò—Å—Ç–µ—á–µ–Ω–∏–µ
‚îî‚îÄ> status = 'expired'
```

#### –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–¥–∞–≤–µ—Ü –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π
- ‚úÖ `sold_at` –∏ `delete_at` –æ–±–Ω—É–ª—è—é—Ç—Å—è
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `active`

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ (car):
- –ë—Ä–µ–Ω–¥, –º–æ–¥–µ–ª—å, –≥–æ–¥
- –ü—Ä–æ–±–µ–≥, —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è, —Ç–∏–ø —Ç–æ–ø–ª–∏–≤–∞
- –¶–≤–µ—Ç, —Ç–∏–ø –∫—É–∑–æ–≤–∞
- AI –∞–Ω–∞–ª–∏–∑ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π
- –û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### –õ–æ—à–∞–¥–∏ (horse):
- –ü–æ—Ä–æ–¥–∞ (15+ –ø–æ—Ä–æ–¥)
- –í–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª (–∂–µ—Ä–µ–±–µ—Ü/–∫–æ–±—ã–ª–∞/–º–µ—Ä–∏–Ω)
- –ú–∞—Å—Ç—å (7+ —Ü–≤–µ—Ç–æ–≤)
- –†–æ—Å—Ç –≤ —Ö–æ–ª–∫–µ
- –£—Ä–æ–≤–µ–Ω—å –æ–±—É—á–µ–Ω–∏—è
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (—Å–∫–∞—á–∫–∏, –≤–µ—Ä—Ö–æ–≤–∞—è –µ–∑–¥–∞, —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ, —Å–ø–æ—Ä—Ç)
- –†–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è
- –í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 3. AI –∞–Ω–∞–ª–∏–∑ –¥–ª—è –æ–±–µ–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### –î–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–∞—Ä–∫–∏ –∏ –º–æ–¥–µ–ª–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞
- –ê–Ω–∞–ª–∏–∑ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π
- –û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞
- –û—Ü–µ–Ω–∫–∞ —Ä—ã–Ω–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏

#### –î–ª—è –ª–æ—à–∞–¥–µ–π:
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–æ—Ä–æ–¥—ã
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Ç–∏
- –û—Ü–µ–Ω–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ (young/adult/old)
- –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–∏–¥–∏–º—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤
- –û—Ü–µ–Ω–∫–∞ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞
- Quality score
- –¢–µ–≥–∏ (—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è, –ø–æ—Ä–æ–¥–∏—Å—Ç–∞—è, –∑–¥–æ—Ä–æ–≤–∞—è)

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (Cron)

Supabase Edge Function –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å:
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å `delete_at <= NOW()`
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –≤–∏–¥–µ–æ –∏–∑ api.video
- ‚úÖ –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `archived`
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å `expires_at <= NOW()`
- ‚úÖ –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å `expired`
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

### 5. API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### Backend API:
- RESTful endpoints
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏

#### Supabase RLS:
- Row Level Security –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ª—é–±–æ–º —Å—Ç–∞—Ç—É—Å–µ
- –í—Å–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É

```bash
# –í Supabase Dashboard ‚Üí SQL Editor
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ supabase-listings-schema.sql
```

### 2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: SQL —Ñ—É–Ω–∫—Ü–∏—è
SELECT migrate_cars_to_listings();

# –í–∞—Ä–∏–∞–Ω—Ç 2: TypeScript —Å–∫—Ä–∏–ø—Ç
ts-node scripts/migrate-to-listings.ts --verbose
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Edge Function

```bash
supabase functions deploy cleanup-listings
supabase secrets set APIVIDEO_API_KEY=your_key
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cron

```bash
# –í Supabase Dashboard ‚Üí SQL Editor
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ supabase-cron-schedule.sql
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å Backend

```bash
cd backend
npm install
npm run dev
```

### 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å Frontend

```bash
npm install
npm start
```

---

## üìä –°—Ç–∞—Ç—É—Å—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∏–¥–∏–º–æ—Å—Ç—å | –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞ |
|--------|----------|-----------|------------|
| `active` | –ê–∫—Ç–∏–≤–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π ‚Üí `expired` |
| `sold` | –ü—Ä–æ–¥–∞–Ω–æ | –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü | –ê—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π ‚Üí `archived` |
| `archived` | –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ | –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü | –í–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ |
| `expired` | –ò—Å—Ç–µ–∫–ª–æ | –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü | –ú–æ–∂–Ω–æ —Ä–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS –ü–æ–ª–∏—Ç–∏–∫–∏:
- ‚úÖ –ê–Ω–æ–Ω–∏–º—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ `active` –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ª—é–±–æ–º —Å—Ç–∞—Ç—É—Å–µ
- ‚úÖ –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å
- ‚úÖ –¢–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å

### API:
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Rate limiting

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ò–Ω–¥–µ–∫—Å—ã:
- ‚úÖ `category` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ `status` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- ‚úÖ `created_at DESC` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- ‚úÖ `delete_at` (partial) - –¥–ª—è cron –æ—á–∏—Å—Ç–∫–∏
- ‚úÖ `expires_at` (partial) - –¥–ª—è cron –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ `details` –¥–ª—è JSONB –ø–æ–∏—Å–∫–∞
- ‚úÖ Full-text search –∏–Ω–¥–µ–∫—Å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –≤ SELECT
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (10-20 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ Partial –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è conditional queries
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è**
```typescript
// –ê–≤—Ç–æ
const carListing = {
  category: 'car',
  title: 'Toyota Camry 2020',
  details: { brand: 'Toyota', model: 'Camry', year: 2020, ... }
};

// –õ–æ—à–∞–¥—å
const horseListing = {
  category: 'horse',
  title: '–ê—Ö–∞–ª—Ç–µ–∫–∏–Ω—Å–∫–∞—è –∫–æ–±—ã–ª–∞',
  details: { breed: '–ê—Ö–∞–ª—Ç–µ–∫–∏–Ω—Å–∫–∞—è', age: 5, ... }
};
```

2. **–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–¥–∞–Ω–Ω–æ–µ**
```bash
curl -X POST http://localhost:3001/api/listings/:id/mark-sold \
  -H "Authorization: Bearer <token>"
```

3. **–†–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å**
```bash
curl -X POST http://localhost:3001/api/listings/:id/reactivate \
  -H "Authorization: Bearer <token>"
```

4. **Cron job (manual trigger)**
```sql
SELECT net.http_post(
  url := 'https://xxx.supabase.co/functions/v1/cleanup-listings',
  headers := jsonb_build_object('Authorization', 'Bearer xxx')
);
```

---

## üìù TODO (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –¥–Ω—è –¥–æ —É–¥–∞–ª–µ–Ω–∏—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–∞—Ö
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- [ ] Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏
- [ ] Scheduled –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- [ ] –®–∞–±–ª–æ–Ω—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ (–¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - JSONB details –¥–ª—è –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - RLS + JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã  
‚úÖ **AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –¥–ª—è –æ–±–µ–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ** - –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–∞–Ω–æ" —Å —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è 360Auto MVP** üöóüê¥  
**–í–µ—Ä—Å–∏—è: 2.0**  
**–î–∞—Ç–∞: 2025-10-13**

