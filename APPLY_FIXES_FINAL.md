# üöÄ –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø - –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û (–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø)

### üéØ –†–ê–ó–†–ï–®–ï–ù–ò–Ø –î–õ–Ø –ì–û–°–¢–ï–ô:
- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–õ–∞–π–∫–∏** - —Ä–∞–±–æ—Ç–∞—é—Ç (—Å—á–µ—Ç—á–∏–∫–∏ —Å—á–∏—Ç–∞—é—Ç!)
- ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–ü–æ–∏—Å–∫** - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - –ó–ê–ü–†–ï–©–ï–ù–´ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
- ‚ùå **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –ó–ê–ü–†–ï–©–ï–ù–û (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
- ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π** - –ó–ê–ü–†–ï–©–ï–ù–û (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)

---

## üìÅ –§–ò–ù–ê–õ–¨–ù–´–ï –§–ê–ô–õ–´

### 1. SQL –ò–Ω–¥–µ–∫—Å—ã (supabase-search-indexes.sql)
- 35 –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è JSONB —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ auto, horse, real_estate
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (russian)

### 2. RLS –ü–æ–ª–∏—Ç–∏–∫–∏ (supabase-rls-policies.sql)
- 22 –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –õ–∞–π–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–ª—è –≥–æ—Å—Ç–µ–π
- ‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –¥–ª—è –≥–æ—Å—Ç–µ–π

### 3. –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `app/(tabs)/index.tsx` - –ª–∞–π–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≥–æ—Å—Ç–µ–π
- `components/VideoFeed/VideoPlayer.tsx` - –ª–∞–π–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≥–æ—Å—Ç–µ–π

---

## üöÄ –ë–´–°–¢–†–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï (3 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: Supabase Dashboard
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **360Auto**
3. –ù–∞–∂–º–∏—Ç–µ **SQL Editor** ‚Üí **+ New query**

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–Ω–¥–µ–∫—Å—ã
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase-search-indexes.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** –∫–æ–¥ (Cmd+A, Cmd+C)
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **Run** (Cmd+Enter)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `Success. No rows returned` ‚úÖ

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
1. –ù–∞–∂–º–∏—Ç–µ **+ New query** (–Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase-rls-policies.sql`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** –∫–æ–¥ (Cmd+A, Cmd+C)
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **Run** (Cmd+Enter)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `Success. No rows returned` ‚úÖ

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
cd /Users/ulanbekgaiypov/360AutoMVP
npx expo start --clear
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: Guest Mode

1. **–ù–ï –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å**
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:**
   - ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –õ–∞–π–∫ ‚Üí **–†–ê–ë–û–¢–ê–ï–¢!** ‚ù§Ô∏è (—Å–µ—Ä–¥–µ—á–∫–æ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è)
   - ‚úÖ –ü–æ–∏—Å–∫ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Üí –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –º–æ–¥–∞–ª–∫–∞ "–í–æ–π–¥–∏—Ç–µ"
   - ‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –º–æ–¥–∞–ª–∫–∞ "–í–æ–π–¥–∏—Ç–µ"

### –¢–µ—Å—Ç 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π

1. **–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç**
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:**
   - ‚úÖ –õ–∞–π–∫ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î)
   - ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –í SQL

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
SELECT COUNT(*) as indexes_count
FROM pg_indexes 
WHERE tablename = 'listings';
-- –î–æ–ª–∂–Ω–æ: 35+ ‚úÖ

-- 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT tablename, policyname, cmd, roles
FROM pg_policies 
WHERE tablename IN ('likes', 'saves', 'comments')
ORDER BY tablename;
-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
-- likes: 3 –ø–æ–ª–∏—Ç–∏–∫–∏ (anon, authenticated)
-- saves: 4 –ø–æ–ª–∏—Ç–∏–∫–∏ (—Ç–æ–ª—å–∫–æ authenticated)
-- comments: 4 –ø–æ–ª–∏—Ç–∏–∫–∏ (—Ç–æ–ª—å–∫–æ authenticated)

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT routine_name, string_agg(DISTINCT grantee, ', ') as granted_to
FROM information_schema.routine_privileges
WHERE routine_name LIKE '%listing%'
GROUP BY routine_name;
-- –î–æ–ª–∂–Ω–æ:
-- increment_listing_likes ‚Üí anon, authenticated ‚úÖ
-- increment_listing_views ‚Üí anon, authenticated ‚úÖ
```

---

## üìä –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

### –õ–∞–π–∫–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π:

**UI (React Native):**
```typescript
// –ì–æ—Å—Ç—å –Ω–∞–∂–∏–º–∞–µ—Ç –ª–∞–π–∫
handleLike() {
  setLikesCount(prev => prev + 1); // ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
  
  if (currentUser) {
    db.likeCar(userId, carId); // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
  } else {
    console.log('Guest liked'); // ‚úÖ –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ
  }
}
```

**–ë–î (Supabase):**
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ª–∞–π–∫–æ–≤
CREATE POLICY "Anyone can like"
  ON likes FOR INSERT
  TO anon, authenticated  -- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ –¥–ª—è –≥–æ—Å—Ç–µ–π!
  WITH CHECK (true);

-- –§—É–Ω–∫—Ü–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
GRANT EXECUTE ON FUNCTION increment_listing_likes(UUID) 
  TO anon, authenticated; -- ‚úÖ –ì–æ—Å—Ç–∏ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å
```

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ó–ê–ü–†–ï–©–ï–ù–´ –¥–ª—è –≥–æ—Å—Ç–µ–π):

**–ë–î (Supabase):**
```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
CREATE POLICY "Authenticated users can comment"
  ON comments FOR INSERT
  TO authenticated  -- ‚ùå –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ!
  WITH CHECK (user_id = auth.uid());
```

---

## üéØ –ò–¢–û–ì

| –§—É–Ω–∫—Ü–∏—è | –ì–æ—Å—Ç–∏ | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ |
|---------|-------|----------------|
| –ü—Ä–æ—Å–º–æ—Ç—Ä | ‚úÖ | ‚úÖ |
| –ü–æ–∏—Å–∫ | ‚úÖ | ‚úÖ |
| –õ–∞–π–∫–∏ | ‚úÖ (–ª–æ–∫–∞–ª—å–Ω–æ) | ‚úÖ (–≤ –ë–î) |
| –ü—Ä–æ—Å–º–æ—Ç—Ä—ã | ‚úÖ | ‚úÖ |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚ùå | ‚úÖ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ | ‚ùå | ‚úÖ |
| –°–æ–∑–¥–∞–Ω–∏–µ | ‚ùå | ‚úÖ |

---

## üêõ –í–û–ó–ú–û–ñ–ù–´–ï –û–®–ò–ë–ö–ò

### "policy already exists"
**–†–µ—à–µ–Ω–∏–µ:** –ù–æ—Ä–º–∞–ª—å–Ω–æ! –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DROP POLICY IF EXISTS`.

### "permission denied"
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ postgres –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Dashboard.

### –õ–∞–π–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≥–æ—Å—Ç–µ–π
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–ª–∏ `supabase-rls-policies.sql`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è: `GRANT ... TO anon, authenticated`

---

## ‚úÖ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- ‚úÖ –ì–æ—Å—Ç–∏ –º–æ–≥—É—Ç –ª–∞–π–∫–∞—Ç—å ‚ù§Ô∏è
- ‚úÖ –ì–æ—Å—Ç–∏ –ù–ï –º–æ–≥—É—Ç –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –ì–æ—Å—Ç–∏ –ù–ï –º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (35 –∏–Ω–¥–µ–∫—Å–æ–≤)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –®–∞–≥–∞ 1!** üöÄ

