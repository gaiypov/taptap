# üìä –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ - Video Upload Service

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

### 1. –§—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ - **–ù–ï–¢ –ö–û–ù–§–õ–ò–ö–¢–û–í** ‚úÖ

#### `apiVideo.uploadVideoToApiVideo()` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
- **–§–∞–π–ª:** `services/apiVideo.ts:424`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `string` (HLS URL)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –±–µ–∑ offline –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞

#### `videoUploader.uploadVideoWithOfflineSupport()` (–Ω–æ–≤–∞—è)
- **–§–∞–π–ª:** `services/videoUploader.ts:92`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å offline/retry
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `UploadResult` –æ–±—ä–µ–∫—Ç
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è production –∑–∞–≥—Ä—É–∑–æ–∫ —Å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç

#### `storage.uploadVideoSmart()` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
- **–§–∞–π–ª:** `services/supabase.ts:1246`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–º–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (api.video –∏–ª–∏ Supabase Storage)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞

**–í—ã–≤–æ–¥:** –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∫–∞–∂–¥–∞—è –∏–º–µ–µ—Ç —Å–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ.

### 2. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ - **–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û** ‚úÖ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `apiVideo.uploadWithToken()`
- `videoUploader.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `apiVideo.uploadWithToken()` –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –õ—é–±—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ `apiVideo.uploadWithToken()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `apiVideo.createVideo()`
- `videoUploader.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ –Ω–∞ api.video

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `apiVideo.getHLSUrl()` –∏ –¥—Ä—É–≥–∏–µ —É—Ç–∏–ª–∏—Ç—ã
- –í—Å–µ URL –º–µ—Ç–æ–¥—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–∑ `apiVideo` —Å–µ—Ä–≤–∏—Å–∞

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - **–ï–î–ò–ù–û–û–ë–†–ê–ó–ù–û** ‚úÖ

–í—Å–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ `appLogger`:
- ‚úÖ `videoUploader.ts` - —Ç–æ–ª—å–∫–æ `appLogger`
- ‚úÖ `useVideoUpload.ts` - —Ç–æ–ª—å–∫–æ `appLogger`
- ‚ö†Ô∏è `apiVideo.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `console.error` (–Ω–æ —ç—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥, –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏)

### 4. Offline Storage - **–ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û** ‚úÖ

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:
  - `savePendingAction()` 
  - `removePendingAction()`
  - `getPendingActions()`
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è SQLite –ª–æ–≥–∏–∫–∏

### 5. –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ - **–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û** ‚úÖ

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `NetInfo` –∏–∑ `@react-native-community/netinfo` (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

### ‚úÖ –ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç —á–µ—Ç–∫—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–¢–∏–ø–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–∞—è TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚ùå –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `FileSystem.uploadAsync` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `apiVideo.uploadWithToken()`
- ‚ùå –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `apiVideo.createVideo()`
- ‚ùå –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è URL - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ—Ç–æ–¥—ã `apiVideo`

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞:
- ‚úÖ –ù–µ –∏–∑–º–µ–Ω–µ–Ω `OptimizedVideoPlayer.tsx`
- ‚úÖ –ù–µ –∏–∑–º–µ–Ω–µ–Ω `video.ts`
- ‚úÖ –ù–µ –∏–∑–º–µ–Ω–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `apiVideo.ts`
- ‚úÖ –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π | ‚úÖ –ù–µ—Ç | –§—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ | ‚úÖ –ù–µ—Ç | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω | ‚úÖ –ù–µ—Ç | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ |
| –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ | ‚úÖ –ù–µ—Ç | –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ | –ß–µ—Ä–µ–∑ appLogger |
| –¢–∏–ø–∏–∑–∞—Ü–∏—è | ‚úÖ –ü–æ–ª–Ω–∞—è | TypeScript —Ç–∏–ø—ã –≤–µ–∑–¥–µ |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ï—Å—Ç—å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ docs/VIDEO_UPLOAD_SERVICE.md |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

1. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:**
   - `storage.uploadVideoSmart()` –º–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `uploadVideoWithOfflineSupport()`
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `VideoUploader` –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ö—É–∫–∞

2. **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:**
   - –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω—É–∂–µ–Ω chunked upload –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π –º–æ–¥—É–ª—å
   - –¢–µ–∫—É—â–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è retry:**
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–≥—Ä—É–∑–æ–∫
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–µ–∫—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ö–æ–¥ –º–æ–¥—É–ª—å–Ω—ã–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π
- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

