# üöÄ Realtime Quick Start Guide

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (5 –º–∏–Ω—É—Ç)

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
   ```
   supabase/migrations/20250121_enable_realtime_complete.sql
   ```
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è chat_threads: 3
‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è chat_messages: 3
‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è listings: 2
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:
```sql
-- –§–∞–π–ª: supabase/migrations/20250121_check_realtime_status.sql
```

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é:
```sql
SELECT tablename FROM pg_publication_tables 
WHERE pubname = 'supabase_realtime';
```

**–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
- `chat_threads`
- `chat_messages`
- `listings`
- `listing_likes`
- `listing_saves`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ANON KEY

**‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–∫–ª–∏–µ–Ω—Ç):**
```typescript
// services/supabase.ts
const supabaseAnonKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY;
export const supabase = createClient(url, supabaseAnonKey);
```

**‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (realtime):**
```typescript
// services/realtime.ts
import { supabase } from '@/services/supabase'; // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç anon key
```

**‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```typescript
// –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ service_role –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ!
const supabase = createClient(url, SERVICE_ROLE_KEY);
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

```bash
chmod +x scripts/check-realtime-setup.sh
./scripts/check-realtime-setup.sh
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –Ω–∞ –¥–≤—É—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. **–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –Ω–∞ –≤—Ç–æ—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

### –¢–µ—Å—Ç 2: –õ–∞–π–∫–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
2. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –ª–∞–π–∫
3. **–°—á–µ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å—Å—è** –±–µ–∑ refresh

### –¢–µ—Å—Ç 3: –°—Ç–∞—Ç—É—Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
1. –ü–æ–º–µ—Ç—å—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–∞–∫ "–ü—Ä–æ–¥–∞–Ω–æ"
2. **–û–Ω–æ –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å** –∏–∑ –ª–µ–Ω—Ç—ã —É –≤—Å–µ—Ö

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: "permission denied"

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è service_role –∏–ª–∏ –Ω–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `EXPO_PUBLIC_SUPABASE_ANON_KEY`?
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ RLS: `20250102_rls_fixes.sql` –∏ `20250120_chat_rls_policies.sql`

### –ü—Ä–æ–±–ª–µ–º–∞: Realtime –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞? (—Å–º. –®–∞–≥ 2)
2. RLS –≤–∫–ª—é—á–µ–Ω? (—Å–º. SQL –ø—Ä–æ–≤–µ—Ä–∫—É)
3. WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ? (DevTools ‚Üí Network ‚Üí WS)

---

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ANON KEY (–Ω–µ service_role)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

**–ì–æ—Ç–æ–≤–æ!** üéâ Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

