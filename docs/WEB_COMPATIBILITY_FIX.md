# üåê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Web –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π

## –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–∞ web:
```
Unable to resolve module ./wa-sqlite/wa-sqlite.wasm from expo-sqlite/web/worker.ts
```

## –ü—Ä–∏—á–∏–Ω–∞

`expo-sqlite` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç WASM —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ web, –Ω–æ –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ Metro bundler.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£—Å–ª–æ–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç SQLite

SQLite —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (iOS/Android):
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Platform.OS !== 'web'` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ù–∞ web –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AsyncStorage –∫–∞–∫ fallback

### 2. Fallback –Ω–∞ AsyncStorage –¥–ª—è Web

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ `offlineStorage.ts` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–±–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
- **Native (iOS/Android)**: SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Web**: AsyncStorage (localStorage)

### 3. Metro Config –æ–±–Ω–æ–≤–ª–µ–Ω

–î–æ–±–∞–≤–ª–µ–Ω `blockList` –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è WASM —Ñ–∞–π–ª–æ–≤:
```javascript
blockList: [
  /node_modules\/expo-sqlite\/web\/.*\.wasm$/,
  /wa-sqlite\/.*\.wasm$/,
],
```

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### `services/offlineStorage.ts`

- ‚úÖ –£—Å–ª–æ–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç SQLite —Ç–æ–ª—å–∫–æ –¥–ª—è native
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–±–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ AsyncStorage –¥–ª—è web
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API

### –§—É–Ω–∫—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–±–µ–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º:

- `initOfflineStorage()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `getCachedListings()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—ç—à–∞
- `cacheListings()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
- `cacheVideoUrl()` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ URL
- `getCachedVideoUrl()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ URL
- `savePendingAction()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- `getPendingActions()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- `removePendingAction()` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- `clearExpiredCache()` - –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫—ç—à–∞
- `getCacheSize()` - —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

API –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º - –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:

```typescript
import { initOfflineStorage, cacheListings, getCachedListings } from '@/services/offlineStorage';

// –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
await initOfflineStorage();
await cacheListings(listings, 'cars');
const cached = await getCachedListings('cars');
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ web –±–µ–∑ –æ—à–∏–±–æ–∫  
‚úÖ –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö  
‚úÖ SQLite –Ω–∞ native (–±—ã—Å—Ç—Ä–µ–µ, –±–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π)  
‚úÖ AsyncStorage –Ω–∞ web (–ø—Ä–æ—â–µ, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)  
‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ - –∫–æ–¥ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

