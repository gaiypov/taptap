# üîë –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–∏ Yandex Cloud –≤ .env

**–ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π**

---

## üìù –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .env

```bash
cd backend
nano .env
# –∏–ª–∏
code .env
# –∏–ª–∏
open -a TextEdit .env
```

---

## üìù –®–∞–≥ 2: –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é Yandex Cloud

–ù–∞–π–¥–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ —Å—Ç—Ä–æ–∫–∏ (–∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞):

```bash
# ============================================
# YANDEX CLOUD VIDEO
# ============================================
```

---

## üìù –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–ª—é—á–∏

–ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏:

```bash
# Yandex Cloud Video (NEW - replacing api.video)
YANDEX_OAUTH_TOKEN=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_oauth_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
YANDEX_FOLDER_ID=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_folder_id_–∑–¥–µ—Å—å
YANDEX_VIDEO_CHANNEL_ID=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_channel_id_–∑–¥–µ—Å—å
YANDEX_CDN_DOMAIN=–≤–∞—à_cdn_domain.cdn.yandex.net  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
YANDEX_OAUTH_TOKEN=y0_AgA...abc123def456
YANDEX_FOLDER_ID=b1g1234567890abcdef
YANDEX_VIDEO_CHANNEL_ID=ch1234567890abcdef
YANDEX_CDN_DOMAIN=360automvp.cdn.yandex.net
```

---

## üìù –®–∞–≥ 4: –î–æ–±–∞–≤—å—Ç–µ VK Cloud (–µ—Å–ª–∏ –µ—Å—Ç—å)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–ª—é—á–∏ VK Cloud, –¥–æ–±–∞–≤—å—Ç–µ:

```bash
# ============================================
# VK CLOUD STORAGE (Backups)
# ============================================
VK_CLOUD_ENDPOINT=https://hb.ru-msk.vkcs.cloud
VK_CLOUD_REGION=ru-msk
VK_CLOUD_ACCESS_KEY=–≤–∞—à_access_key_–∑–¥–µ—Å—å
VK_CLOUD_SECRET_KEY=–≤–∞—à_secret_key_–∑–¥–µ—Å—å
VK_CLOUD_BUCKET_NAME=360automvp-backups
```

---

## ‚úÖ –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª** (Ctrl+O, Enter, Ctrl+X –≤ nano)

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:**
   ```bash
   npm run check-cloud-env
   ```

3. **–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:**
   ```
   ‚úÖ All required environment variables are set!
   ```

---

## üß™ –®–∞–≥ 6: –¢–µ—Å—Ç IAM —Ç–æ–∫–µ–Ω–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:

```bash
node -e "require('./services/yandex/iamToken').iamTokenManager.getToken().then(token => console.log('‚úÖ IAM Token –ø–æ–ª—É—á–µ–Ω!')).catch(err => console.error('‚ùå –û—à–∏–±–∫–∞:', err.message))"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–±–µ–ª—ã** –≤–æ–∫—Ä—É–≥ `=`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `YANDEX_OAUTH_TOKEN=token123`
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `YANDEX_OAUTH_TOKEN = token123`

2. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–≤—ã—á–∫–∏** (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã)
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `YANDEX_FOLDER_ID=b1g123`
   - ‚úÖ –ú–æ–∂–Ω–æ: `YANDEX_FOLDER_ID="b1g123"`

3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª** –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π

4. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env** –≤ git (—É–∂–µ –≤ .gitignore)

---

## üÜò –ü—Ä–æ–±–ª–µ–º—ã?

### –û—à–∏–±–∫–∞: "YANDEX_OAUTH_TOKEN is not set"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É

### –û—à–∏–±–∫–∞: "IAM token refresh failed"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ OAuth —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ https://oauth.yandex.ru/

---

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] –§–∞–π–ª `.env` –æ—Ç–∫—Ä—ã—Ç
- [ ] YANDEX_OAUTH_TOKEN –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] YANDEX_FOLDER_ID –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] YANDEX_VIDEO_CHANNEL_ID –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] YANDEX_CDN_DOMAIN –¥–æ–±–∞–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- [ ] `npm run check-cloud-env` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚úÖ
- [ ] –¢–µ—Å—Ç IAM —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–ª—é—á–µ–π –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

