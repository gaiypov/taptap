#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ 3001

PORT=${1:-3001}

echo "üîç –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É $PORT..."

PID=$(lsof -ti:$PORT)

if [ -z "$PID" ]; then
    echo "‚úÖ –ü–æ—Ä—Ç $PORT —Å–≤–æ–±–æ–¥–µ–Ω"
    exit 0
fi

echo "üìã –ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å: $PID"
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å..."

kill -9 $PID

sleep 1

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—â–µ —Ä–∞–∑
if lsof -ti:$PORT > /dev/null 2>&1; then
    echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
    kill -9 $PID 2>/dev/null
    sleep 1
fi

if lsof -ti:$PORT > /dev/null 2>&1; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç $PORT"
    exit 1
else
    echo "‚úÖ –ü–æ—Ä—Ç $PORT –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω!"
    exit 0
fi

